<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniSelector - Authentication</title>
    <link rel="icon" href="images/Uni-logo.png" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black-color: #0f0f13;
            --dark-blue: #1a1a2e;
            --purple: #8a2be2;
            --skyblue: #00b4d8;
            --green: #00cc66;
            --yellow: #ffd166;
            --light-color: #f8f9fc;
            --accent-color: #6a4c93;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--black-color) 0%, var(--dark-blue) 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        
        .auth-container {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            width: 100%;
            max-width: 1000px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(138, 43, 226, 0.2);
        }
        
        .auth-left {
            background: linear-gradient(135deg, var(--purple) 0%, var(--skyblue) 100%);
            color: white;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .auth-right {
            padding: 40px;
        }
        
        .auth-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(15, 15, 19, 0.5);
        }
        
        .auth-tabs button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .auth-tabs button.active {
            background: linear-gradient(135deg, var(--purple) 0%, var(--skyblue) 100%);
            color: white;
        }
        
        .user-type-selector {
            display: flex;
            margin-bottom: 25px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(15, 15, 19, 0.5);
        }
        
        .user-type-selector button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .user-type-selector button.active {
            background: linear-gradient(135deg, var(--green) 0%, var(--skyblue) 100%);
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-group label {
            position: absolute;
            top: 12px;
            left: 15px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
            pointer-events: none;
            background: var(--dark-blue);
            padding: 0 5px;
        }
        
        .form-group input:focus + label,
        .form-group input:not(:placeholder-shown) + label {
            top: -10px;
            left: 10px;
            font-size: 12px;
            color: var(--skyblue);
        }
        
        .form-control {
            padding: 15px;
            height: 50px;
            border-radius: 8px;
            background: rgba(15, 15, 19, 0.6);
            border: 1px solid rgba(138, 43, 226, 0.3);
            color: white;
        }
        
        .form-control:focus {
            border-color: var(--purple);
            box-shadow: 0 0 0 0.2rem rgba(138, 43, 226, 0.25);
            background: rgba(15, 15, 19, 0.8);
            color: white;
        }
        
        .btn-auth {
            background: linear-gradient(135deg, var(--purple) 0%, var(--skyblue) 100%);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-auth:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-admin {
            background: linear-gradient(135deg, var(--green) 0%, var(--skyblue) 100%);
        }
        
        .alert {
            border-radius: 8px;
            padding: 12px 15px;
            background: rgba(26, 26, 46, 0.9);
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 15px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .debug-panel {
            background: rgba(15, 15, 19, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        .admin-features {
            margin-top: 20px;
            padding: 15px;
            background: rgba(15, 15, 19, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 204, 102, 0.3);
        }
        
        .admin-features h5 {
            color: var(--green);
            margin-bottom: 10px;
        }
        
        .admin-features ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .admin-features li {
            margin-bottom: 5px;
        }
        
        .admin-pin-field {
            display: none;
        }
        
        @media (max-width: 768px) {
            .auth-left {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="row g-0">
            <div class="col-md-5">
                <div class="auth-left">
                    <i class="fas fa-graduation-cap auth-icon"></i>
                    <h2>Welcome to UniSelector</h2>
                    <p>Sign in to access your personalized university matching platform or manage the system as an administrator.</p>
                </div>
            </div>
            <div class="col-md-7">
                <div class="auth-right">
                    <div class="auth-tabs">
                        <button id="loginBtn" class="active">Sign In</button>
                        <button id="registerBtn">Sign Up</button>
                    </div>
                    
                    <div class="user-type-selector">
                        <button id="userTypeBtn" class="active">User</button>
                        <button id="adminTypeBtn">Admin</button>
                    </div>
                    
                    <div id="loginForm">
                        <h3 class="mb-4">Sign In to Your Account</h3>
                        <div id="loginAlert"></div>
                        
                        <form id="loginFormElement">
                            <div class="form-group">
                                <input type="email" class="form-control" id="loginEmail" placeholder=" ">
                                <label for="loginEmail">Email Address</label>
                            </div>
                            
                            <div class="form-group">
                                <input type="password" class="form-control" id="loginPassword" placeholder=" ">
                                <label for="loginPassword">Password</label>
                                <i class="fas fa-eye password-toggle" id="loginPasswordToggle"></i>
                            </div>
                            
                            <!-- Admin PIN Field for Login -->
                            <div class="form-group admin-pin-field" id="loginPinField">
                                <input type="password" class="form-control" id="loginPin" placeholder=" ">
                                <label for="loginPin">Admin PIN</label>
                            </div>
                            
                            <div class="form-group form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">Remember me</label>
                            </div>
                            
                            <button type="submit" class="btn-auth mb-3">Sign In</button>
                            
                            <div class="text-center">
                                <a href="#" class="text-decoration-none">Forgot your password?</a>
                            </div>
                        </form>
                        
                        <div id="adminFeatures" class="admin-features" style="display: none;">
                            <h5><i class="fas fa-star me-2"></i>Admin Features</h5>
                            <ul>
                                <li>Manage user accounts and permissions</li>
                                <li>View system analytics and reports</li>
                                <li>Update university database</li>
                                <li>Monitor application statistics</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div id="registerForm" style="display: none;">
                        <h3 class="mb-4">Create Your Account</h3>
                        <div id="registerAlert"></div>
                        
                        <form id="registerFormElement">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="firstName" placeholder=" ">
                                        <label for="firstName">First Name</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="lastName" placeholder=" ">
                                        <label for="lastName">Last Name</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <input type="email" class="form-control" id="registerEmail" placeholder=" ">
                                <label for="registerEmail">Email Address</label>
                            </div>
                            
                            <div class="form-group">
                                <input type="password" class="form-control" id="registerPassword" placeholder=" " minlength="6">
                                <label for="registerPassword">Password (min. 6 characters)</label>
                                <i class="fas fa-eye password-toggle" id="registerPasswordToggle"></i>
                            </div>
                            
                            <div class="form-group">
                                <input type="password" class="form-control" id="confirmPassword" placeholder=" ">
                                <label for="confirmPassword">Confirm Password</label>
                            </div>
                            
                            <!-- Admin PIN Field for Registration -->
                            <div class="form-group admin-pin-field" id="registerPinField">
                                <input type="password" class="form-control" id="registerPin" placeholder=" ">
                                <label for="registerPin">Admin PIN</label>
                            </div>
                            
                            <div class="form-group form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="termsAgree">
                                <label class="form-check-label" for="termsAgree">I agree to the <a href="#" class="text-decoration-none">Terms and Conditions</a></label>
                            </div>
                            
                            <button type="submit" class="btn-auth">Create Account</button>
                        </form>
                    </div> 
                    
                    <!-- Debug Panel -->
                    <div class="debug-panel mt-4" id="debugPanel" style="display: none;">
                        <h6>Debug Information</h6>
                        <div id="debugContent"></div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button class="btn btn-sm btn-outline-light" id="toggleDebug">Show Debug</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    // DOM Elements
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const userTypeBtn = document.getElementById('userTypeBtn');
const adminTypeBtn = document.getElementById('adminTypeBtn');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const loginFormElement = document.getElementById('loginFormElement');
const registerFormElement = document.getElementById('registerFormElement');
const loginAlert = document.getElementById('loginAlert');
const registerAlert = document.getElementById('registerAlert');
const loginPasswordToggle = document.getElementById('loginPasswordToggle');
const registerPasswordToggle = document.getElementById('registerPasswordToggle');
const debugPanel = document.getElementById('debugPanel');
const debugContent = document.getElementById('debugContent');
const toggleDebug = document.getElementById('toggleDebug');
const adminFeatures = document.getElementById('adminFeatures');
const loginPinField = document.getElementById('loginPinField');
const registerPinField = document.getElementById('registerPinField');

// API Base URL
const API_BASE_URL = 'http://localhost:5000';
let isAdmin = false;

// Switch between login and register forms
loginBtn.addEventListener('click', () => {
    loginBtn.classList.add('active');
    registerBtn.classList.remove('active');
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    clearAlerts();
});

registerBtn.addEventListener('click', () => {
    registerBtn.classList.add('active');
    loginBtn.classList.remove('active');
    registerForm.style.display = 'block';
    loginForm.style.display = 'none';
    clearAlerts();
});

// Switch between user and admin
userTypeBtn.addEventListener('click', () => {
    userTypeBtn.classList.add('active');
    adminTypeBtn.classList.remove('active');
    isAdmin = false;
    adminFeatures.style.display = 'none';
    loginPinField.style.display = 'none';
    registerPinField.style.display = 'none';
    updateLoginButton();
    clearAlerts();
});

adminTypeBtn.addEventListener('click', () => {
    adminTypeBtn.classList.add('active');
    userTypeBtn.classList.remove('active');
    isAdmin = true;
    adminFeatures.style.display = 'block';
    loginPinField.style.display = 'block';
    registerPinField.style.display = 'block';
    updateLoginButton();
    clearAlerts();
});

function updateLoginButton() {
    const loginButton = loginFormElement.querySelector('button[type="submit"]');
    if (isAdmin) {
        loginButton.textContent = 'Admin Sign In';
        loginButton.classList.add('btn-admin');
    } else {
        loginButton.textContent = 'Sign In';
        loginButton.classList.remove('btn-admin');
    }
}

// Toggle debug panel
toggleDebug.addEventListener('click', () => {
    if (debugPanel.style.display === 'none') {
        debugPanel.style.display = 'block';
        toggleDebug.textContent = 'Hide Debug';
    } else {
        debugPanel.style.display = 'none';
        toggleDebug.textContent = 'Show Debug';
    }
});

// Toggle password visibility
loginPasswordToggle.addEventListener('click', () => {
    togglePasswordVisibility('loginPassword', loginPasswordToggle);
});

registerPasswordToggle.addEventListener('click', () => {
    togglePasswordVisibility('registerPassword', registerPasswordToggle);
});

function togglePasswordVisibility(inputId, toggleIcon) {
    const passwordInput = document.getElementById(inputId);
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
}

// Handle login form submission
loginFormElement.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        addDebugInfo(`Attempting ${isAdmin ? 'admin' : 'user'} login for: ${email}`);
        
        let requestBody;
        let endpoint;
        
        if (isAdmin) {
            const admin_pin = document.getElementById('loginPin').value;
            endpoint = '/admin/login';
            requestBody = JSON.stringify({ 
                email, 
                password, 
                admin_pin 
            });
        } else {
            endpoint = '/auth/login';
            requestBody = JSON.stringify({ 
                email, 
                password 
            });
        }
        
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: requestBody
        });
        
        const data = await response.json();
        addDebugInfo(`Login response: ${JSON.stringify(data)}`);
        
        if (response.ok) {
            showAlert(loginAlert, `${isAdmin ? 'Admin' : 'User'} login successful! Redirecting...`, 'success');
            // Save token to localStorage
            localStorage.setItem('authToken', data.token);
            
            if (isAdmin) {
                localStorage.setItem('admin', JSON.stringify(data.admin));
                localStorage.setItem('isAdmin', 'true');
            } else {
                localStorage.setItem('user', JSON.stringify(data.user));
                localStorage.setItem('isAdmin', 'false');
            }
            
            // Redirect to appropriate dashboard
            setTimeout(() => {
                window.location.href = isAdmin ? 'admin-dashboard.html' : 'dashboard.html';
            }, 1500);
        } else {
            showAlert(loginAlert, data.error || 'Invalid email or password', 'danger');
        }
    } catch (error) {
        console.error('Login error:', error);
        addDebugInfo(`Login error: ${error.message}`);
        showAlert(loginAlert, 'Login failed. Please try again later.', 'danger');
    }
});

// Handle register form submission
registerFormElement.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // Basic validation
    if (password !== confirmPassword) {
        showAlert(registerAlert, 'Passwords do not match', 'danger');
        return;
    }
    
    if (password.length < 6) {
        showAlert(registerAlert, 'Password must be at least 6 characters', 'danger');
        return;
    }
    
    try {
        addDebugInfo(`Attempting ${isAdmin ? 'admin' : 'user'} registration for: ${email}`);
        addDebugInfo(`Data: ${firstName} ${lastName}, ${email}`);
        
        let requestBody;
        let endpoint;
        
        if (isAdmin) {
            const admin_pin = document.getElementById('registerPin').value;
            endpoint = '/admin/register';
            requestBody = JSON.stringify({ 
                first_name: firstName, 
                last_name: lastName, 
                email, 
                password,
                admin_pin 
            });
        } else {
            endpoint = '/auth/register';
            requestBody = JSON.stringify({ 
                first_name: firstName, 
                last_name: lastName, 
                email, 
                password 
            });
        }
        
        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: requestBody
        });
        
        const data = await response.json();
        addDebugInfo(`Registration response: ${JSON.stringify(data)}`);
        
        if (response.ok) {
            showAlert(registerAlert, `${isAdmin ? 'Admin' : 'User'} registration successful! You can now sign in.`, 'success');
            // Clear form
            registerFormElement.reset();
            // Switch to login form after a delay
            setTimeout(() => {
                loginBtn.click();
            }, 2000);
        } else {
            showAlert(registerAlert, data.error || 'Registration failed', 'danger');
        }
    } catch (error) {
        console.error('Registration error:', error);
        addDebugInfo(`Registration error: ${error.message}`);
        showAlert(registerAlert, 'Registration failed. Please try again later.', 'danger');
    }
});

// Helper function to show alerts
function showAlert(container, message, type) {
    container.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
}

// Add debug information
function addDebugInfo(message) {
    const timestamp = new Date().toLocaleTimeString();
    debugContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
    debugContent.scrollTop = debugContent.scrollHeight;
}

// Clear all alerts
function clearAlerts() {
    loginAlert.innerHTML = '';
    registerAlert.innerHTML = '';
}

// Test backend connection on page load
async function testBackendConnection() {
    try {
        addDebugInfo('Testing connection to backend...');
        const response = await fetch(`${API_BASE_URL}/health`);
        
        if (response.ok) {
            const data = await response.json();
            addDebugInfo(`Backend connection: ${data.status}, Database: ${data.database}`);
        } else {
            addDebugInfo('Backend connection failed');
        }
    } catch (error) {
        addDebugInfo(`Backend connection failed: ${error.message}`);
        addDebugInfo('Make sure your backend server is running on port 5000');
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is already logged in
    const authToken = localStorage.getItem('authToken');
    const isAdmin = localStorage.getItem('isAdmin') === 'true';
    
    if (authToken) {
        // Redirect to appropriate dashboard if already logged in
        window.location.href = isAdmin ? 'admin-dashboard.html' : 'dashboard.html';
        return;
    }
    
    // Remove demo credentials
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
    
    // Test backend connection
    testBackendConnection();
    
    // Initialize the login button text
    updateLoginButton();
});
</script>
</body>
</html>